<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DOM Physics - Text Demo</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      background: #f5f5f5;
      font-family: Georgia, serif;
      overflow: hidden;
    }
    
    body {
      background: #f5f5f5;
      font-family: Georgia, serif;
      overflow: hidden;
    }
    
    .wrapper {
      position: relative;
      width: 800px;
      margin: 40px auto;
    }
    
    #world {
      position: relative;
      width: 800px;
      height: 600px;
      background: #ffffff;
      border: 2px solid #333;
    }
    
    .container {
      padding: 40px;
    }
    
    .text {
      font-size: 18px;
      line-height: 1.8;
      color: #333;
      display: inline-block;
    }
    
    .text span {
      display: inline-block;
      margin: 0;
      padding: 0;
    }
    
    .text span.space {
     <!-- display: inline; -->
      display: inline-block;
      <!-- content: " "; -->
      <!-- white-space: pre; -->
    }


    
    .physics-active .text span {
      position: relative;
    }
    
    .wrapper {
      position: relative;
      width: 800px;
      margin: 40px auto;
    }
    
    .attribution {
      position: absolute;
      bottom: -25px;
      right: 10px;
      font-size: 11px;
      color: #666;
      text-align: right;
    }
    
    .attribution a {
      color: #333;
      text-decoration: none;
    }
    
    .attribution a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <div class="wrapper">
    <div id="world">
      <div class="container">
        <div class="text">
          Two roads diverged in a yellow wood,<br>
          And sorry I could not travel both<br>
          And be one traveler, long I stood<br>
          And looked down one as far as I could<br>
          To where it bent in the undergrowth;
        </div>
      </div>
    </div>
    <div class="attribution">
      "<a href="https://kai4avaya.github.io/dom-physics/demo-text.html">The Road Not Taken</a>"<br>
      by <a href="https://en.wikipedia.org/wiki/Robert_Frost" target="_blank">Robert Frost</a>
    </div>
  </div>

  <script type="module">
    import { World, Body } from './dist/index.js';
    
    const worldElement = document.getElementById('world');
    const textElement = document.querySelector('.text');
    
    let initialized = false;
    let world = null;
    let bodies = [];
    
    <!-- function initializePhysics() { -->
      <!-- if (initialized) return; -->
      <!-- initialized = true; -->
      
      <!-- const text = textElement.innerHTML; -->
      <!-- let wrapped = ''; -->

      <!-- const computedStyle = getComputedStyle(textElement); -->
      <!-- const fontSize = parseFloat(computedStyle.fontSize); // e.g., 18px -> 18 -->
      <!-- const lineHeightRatio = parseFloat(computedStyle.lineHeight); // e.g., 1.8 -> 1.8 -->
      <!-- const spaceHeight = fontSize * lineHeightRatio; // 18 * 1.8 = 32.4 -->

      <!-- // Temporary element creation to measure a space's width -->
      <!-- const tempSpan = document.createElement('span'); -->
      <!-- tempSpan.style.fontSize = getComputedStyle(textElement).fontSize; -->
      <!-- tempSpan.innerHTML = ' '; -->
      <!-- textElement.appendChild(tempSpan); -->

      <!-- // Get the actual computed width of a single space character -->
      <!-- const spaceWidth = tempSpan.getBoundingClientRect().width; --> 
      <!-- textElement.removeChild(tempSpan); --> 
      <!-- // Now, spaceWidth holds the exact width needed! -->

      <!-- let i = 0; -->
      
      <!-- while (i < text.length) { -->
        <!-- const char = text[i]; -->
        
        <!-- if (char === '<') { -->
          <!-- // Extract the entire tag -->
          <!-- let tag = ''; -->
          <!-- while (i < text.length && text[i] !== '>') { -->
            <!-- tag += text[i]; -->
            <!-- i++; -->
          <!-- } -->
          <!-- if (i < text.length) { -->
            <!-- tag += text[i]; // Include the '>' -->
            <!-- i++; -->
          <!-- } -->
          <!-- wrapped += tag; -->
        <!-- } else if (char === ' ') { -->
        <!-- // Inject the calculated width and height (line-height) directly -->
<!-- wrapped += `<span class="space" style="width: ${spaceWidth}px; height: ${spaceHeight}px;"> </span>`;            wrapped += `<span class="space" style="width: ${spaceWidth}px; height: 1.8em;"> </span>`; -->
            <!-- i++; -->
        <!-- } else if (char === '\n') { -->
          <!-- i++; -->
        <!-- } else { -->
          <!-- wrapped += `<span>${char}</span>`; -->
          <!-- i++; -->
        <!-- } -->
      <!-- } -->
      
      <!-- textElement.innerHTML = wrapped; -->
      
      <!-- world = new World(worldElement, { -->
        <!-- gravity: 400, -->
        <!-- friction: 0.97, -->
        <!-- restitution: 0.5 -->
      <!-- }); -->
      
      <!-- const spans = textElement.querySelectorAll('span:not(.space)'); -->

      <!-- const spans = textElement.querySelectorAll('span'); -->

      <!-- spans.forEach((span) => { -->
      <!-- // Check if this span is a space -->
      <!-- const isSpace = span.classList.contains('space'); -->
      
      <!-- const body = new Body(span, world, { -->
        <!-- mass: 1, -->
        <!-- radius: 8, -->
        <!-- restitution: 0.6, -->
        <!-- // Make spaces STATIC, and letters DYNAMIC -->
        <!-- isStatic: isSpace --> 
      <!-- }); -->
      
        <!-- const body = new Body(span, world, { -->
          <!-- mass: 1, -->
          <!-- radius: 8, -->
          <!-- restitution: 0.6 -->
        <!-- }); -->
        <!-- world.registerBody(body); -->
        <!-- bodies.push(body); -->
        <!-- if (!isSpace) { -->
        <!-- bodies.push(body); -->
      <!-- } -->
      <!-- }); -->
      
      <!-- worldElement.classList.add('physics-active'); -->
      <!-- world.start(); -->
    <!-- } -->

function initializePhysics() {
    if (initialized) return;
    initialized = true;
    
    const text = textElement.innerHTML;
    let wrapped = '';

    const computedStyle = getComputedStyle(textElement);
    const fontSize = parseFloat(computedStyle.fontSize); // e.g., 18px -> 18
    
    // --- FIX FOR LINE HEIGHT ---
    // parseFloat(computedStyle.lineHeight) might return pixels if it's set in px.
    // We need the *ratio* (1.8).
    // This is a safer way to get the pixel height.
    const tempLine = document.createElement('div');
    tempLine.style.lineHeight = computedStyle.lineHeight;
    tempLine.style.fontSize = computedStyle.fontSize;
    tempLine.style.position = 'absolute';
    tempLine.style.visibility = 'hidden';
    tempLine.innerHTML = 'A'; // Add content to measure
    document.body.appendChild(tempLine);
    const spaceHeight = tempLine.getBoundingClientRect().height;
    document.body.removeChild(tempLine);
    // --- END FIX ---

    // Temporary element creation to measure a space's width
    const tempSpan = document.createElement('span');
    tempSpan.style.fontSize = getComputedStyle(textElement).fontSize;
    tempSpan.innerHTML = ' ';
    textElement.appendChild(tempSpan);

    // Get the actual computed width of a single space character
    const spaceWidth = tempSpan.getBoundingClientRect().width; 
    textElement.removeChild(tempSpan); 
    // Now, spaceWidth holds the exact width needed!

    let i = 0;
    
    while (i < text.length) {
      const char = text[i];
      
      if (char === '<') {
        // Extract the entire tag
        let tag = '';
        while (i < text.length && text[i] !== '>') {
          tag += text[i];
          i++;
        }
        if (i < text.length) {
          tag += text[i]; // Include the '>'
          i++;
        }
        wrapped += tag;
      } else if (char === ' ') {
        
        // --- FIX: REMOVED DUPLICATE LINE ---
        // Inject the calculated width and height (line-height) directly
        wrapped += `<span class="space" style="width: ${spaceWidth}px; height: ${spaceHeight}px;"> </span>`;
        i++;

      } else if (char === '\n') {
        i++;
      } else {
        wrapped += `<span>${char}</span>`;
        i++;
      }
    }
    
    textElement.innerHTML = wrapped;
    
    world = new World(worldElement, {
      gravity: 400,
      friction: 0.97,
      restitution: 0.5
    });
    
    const spans = textElement.querySelectorAll('span');

    spans.forEach((span) => {
      // Check if this span is a space
      const isSpace = span.classList.contains('space');
      
      // --- FIX: REMOVED DUPLICATE 'const body' ---
      const body = new Body(span, world, {
        mass: 1,
        radius: 8,
        restitution: 0.6,
        // Make spaces STATIC, and letters DYNAMIC
        isStatic: isSpace 
      });

      world.registerBody(body);
      
      if (!isSpace) {
        bodies.push(body);
      }
    });
    
    worldElement.classList.add('physics-active');
    world.start();
  }
      
    textElement.addEventListener('mousemove', (e) => {
      if (!initialized) {
        initializePhysics();
      }
      
      const rect = worldElement.getBoundingClientRect();
      const mx = e.clientX - rect.left;
      const my = e.clientY - rect.top;
      
      bodies.forEach(body => {
        const pos = body.getWorldPosition();
        const dx = pos.x - mx;
        const dy = pos.y - my;
        const dist = Math.sqrt(dx * dx + dy * dy);
        
        if (dist < 80 && dist > 0) {
          const force = (80 - dist) * 80;
          body.applyForce(
            (dx / dist) * force,
            (dy / dist) * force
          );
        }
      });
    });
  </script>
</body>
</html>
